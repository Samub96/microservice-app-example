# ---------- BUILD STAGE ----------
FROM node:8.17.0-alpine AS builder

# Definimos directorio de trabajo
WORKDIR /app

# Copiamos los archivos de configuraci贸n
COPY package*.json ./

# Instalamos dependencias
RUN npm install

# Copiamos el resto del c贸digo fuente
COPY . .

# Construimos la aplicaci贸n
RUN npm run build


# ---------- RUN STAGE ----------
FROM node:8.17.0-alpine

# Definimos variables de entorno por defecto
ENV PORT=8080
ENV AUTH_API_ADDRESS=http://auth-api:8081
ENV TODOS_API_ADDRESS=http://todos-api:8082

WORKDIR /app

# Copiamos desde el build stage solo lo necesario
COPY --from=builder /app ./

# Exponemos el puerto configurado
EXPOSE ${PORT}

# Comando de ejecuci贸n
CMD ["sh", "-c", "npm start"]
